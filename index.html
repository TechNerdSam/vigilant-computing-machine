<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perles d'Invocations - Générateur de Douas Authentiques</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-dark: #111827; --bg-light: #1f2937; --bg-lighter: #374151;
            --text-main: #e5e7eb; --text-muted: #9ca3af; --primary: #34d399; --accent: #f59e0b;
        }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-dark); color: var(--text-main); }
        .font-amiri { font-family: 'Amiri', serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-dark); }
        ::-webkit-scrollbar-thumb { background: var(--bg-lighter); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--primary); }
        .transition-all { transition: all 0.3s ease-in-out; }
        .sidebar { transition: transform 0.3s ease-in-out; }
        .action-btn { background-color: var(--bg-light); color: var(--text-muted); border: 1px solid var(--bg-lighter); border-radius: 9999px; width: 44px; height: 44px; display: inline-flex; justify-content: center; align-items: center; }
        .action-btn:hover { background-color: var(--bg-lighter); color: var(--text-main); }
        .action-btn.active { color: var(--accent); border-color: var(--accent); }
        #notification { transition: opacity 0.5s, transform 0.5s; }
        .search-input { background-color: var(--bg-light); border: 1px solid var(--bg-lighter); }
        .search-input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px var(--primary); }
        .modal { transition: opacity 0.3s ease-in-out; }
        .modal-content { transition: transform 0.3s ease-in-out; }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Notification Flottante -->
    <div id="notification" class="fixed top-5 right-5 bg-primary text-gray-900 font-bold py-2 px-4 rounded-lg shadow-lg opacity-0 transform translate-y-[-20px] z-50"></div>

    <div class="relative min-h-screen md:flex">
        <!-- En-tête mobile -->
        <div class="md:hidden flex justify-between items-center p-4 bg-gray-900 border-b border-gray-800">
            <h1 class="text-xl font-bold text-white">Perles d'Invocations</h1>
            <button id="mobile-menu-btn" class="text-white focus:outline-none"><i class="fas fa-bars fa-lg"></i></button>
        </div>

        <!-- Barre latérale -->
        <aside id="sidebar" class="bg-gray-900 w-72 p-6 h-screen sticky top-0 transform -translate-x-full md:translate-x-0 z-30 border-r border-gray-800 flex flex-col">
            <a href="#" id="home-btn" class="flex items-center mb-8 cursor-pointer">
                <i class="fas fa-gem text-3xl text-primary mr-3"></i>
                <h1 class="text-2xl font-bold text-white hidden md:block">Perles d'Invocations</h1>
            </a>
            <p class="text-sm text-gray-400 mb-8 hidden md:block">Votre compagnon quotidien pour les invocations.</p>
            
            <nav class="flex-grow">
                <!-- Recherche -->
                <div class="relative mb-6">
                    <input type="text" id="search-input" placeholder="Rechercher..." class="w-full search-input py-2 px-4 rounded-full text-white focus:ring-2 focus:ring-primary transition-all">
                    <i class="fas fa-search absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                </div>
                
                <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Menu</h2>
                <ul class="space-y-2 mb-8">
                    <li><a href="#" id="dua-of-the-day-btn" class="flex items-center text-lg font-semibold text-gray-300 hover:text-primary transition-all"><i class="fas fa-star w-8 text-center text-accent"></i> Doua du Jour</a></li>
                    <li><a href="#" id="favorites-btn" class="flex items-center text-lg font-medium text-gray-400 hover:text-primary transition-all"><i class="fas fa-heart w-8 text-center"></i> Mes Favoris</a></li>
                </ul>
                
                <h2 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Catégories</h2>
                <ul id="categories-list" class="space-y-2 overflow-y-auto max-h-52 pr-2"></ul>
            </nav>
            <footer class="text-xs text-gray-500">
                <a href="mailto:suggestion.doua@example.com?subject=Suggestion de Doua" class="hover:text-primary">Suggérer une Doua</a>
                <p class="mt-2">Version 2.0 - 2025</p>
            </footer>
        </aside>

        <!-- Contenu principal -->
        <main class="flex-1 overflow-y-auto" style="background: linear-gradient(180deg, var(--bg-light) 0%, var(--bg-dark) 20%);">
            <div id="main-content" class="p-4 md:p-8 max-w-4xl mx-auto">
                <!-- La vue principale (générateur ou liste) sera injectée ici -->
            </div>
        </main>
    </div>

    <!-- Modale pour la liste des favoris -->
    <div id="favorites-modal" class="modal fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center p-4 opacity-0 pointer-events-none z-50">
        <div id="modal-content" class="modal-content bg-light rounded-2xl shadow-2xl w-full max-w-2xl max-h-[80vh] transform scale-95">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-white">Mes Favoris</h2>
                    <button id="close-modal-btn" class="text-gray-400 hover:text-white text-3xl">&times;</button>
                </div>
                <div id="favorites-list" class="overflow-y-auto max-h-[65vh]"></div>
            </div>
        </div>
    </div>


    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- BASE DE DONNÉES DE DOUAS ÉTENDUE ---
        const duas = [
            { id: 1, category: "Coranique", arabic: "رَبَّنَا آتِنَا فِي الدُّنْيَا حَسَنَةً وَفِي الْآخِرَةِ حَسَنَةً وَقِنَا عَذَابَ النَّارِ", transliteration: "Rabbanā ātinā fī d-dunyā ḥasanatan wa-fī l-ākhirati ḥasanatan wa-qinā ʿadhāba n-nār.", translation_fr: "Seigneur ! Accorde-nous belle part ici-bas, et belle part aussi dans l'au-delà ; et protège-nous du châtiment du Feu !", source: "Coran, 2:201" },
            { id: 2, category: "Pardon", arabic: "أَسْتَغْفِرُ اللّٰهَ الَّذِي لَا إِلٰهَ إِلَّا هُوَ الْحَيَّ الْقَيُّومَ وَأَتُوبُ إِلَيْهِ", transliteration: "Astaghfiru-llāha-lladhī lā ilāha illā huwa-l-ḥayya-l-qayyūma wa atūbu ilayh.", translation_fr: "Je demande pardon à Allah en dehors de qui il n’y a pas d’autre divinité, le Vivant, Celui qui subsiste par Lui-même, et je me repens à Lui.", source: "Abou Daoud, Tirmidhi" },
            { id: 3, category: "Matin", arabic: "أَصْبَحْنَا وَأَصْبَحَ الْمُلْكُ لِلَّهِ، وَالْحَمْدُ لِلَّهِ، لاَ إِلَهَ إِلاَّ اللَّهُ وَحْدَهُ لاَ شَرِيكَ لَهُ، لَهُ الْمُلْكُ وَلَهُ الْحَمْدُ وَهُوَ عَلَى كُلِّ شَيْءٍ قَدِيرٌ", transliteration: "Aṣbaḥnā wa aṣbaḥa-l-mulku li-llāh...", translation_fr: "Nous voici au matin et la royauté appartient à Allah, de même que la louange...", source: "Muslim" },
            { id: 4, category: "Parents", arabic: "رَّبِّ ارْحَمْهُمَا كَمَا رَبَّيَانِي صَغِيرًا", transliteration: "Rabbi irḥamhumā kamā rabbayānī ṣaghīrā.", translation_fr: "Ô mon Seigneur, fais-leur, à tous deux, miséricorde comme ils m'ont élevé tout petit.", source: "Coran, 17:24" },
            { id: 5, category: "Protection", arabic: "أَعُوذُ بِكَلِمَاتِ اللَّهِ التَّامَّاتِ مِنْ شَرِّ مَا خَلَقَ", transliteration: "A'ūdhu bikalimāti-llāhi-t-tāmmāti min sharri mā khalaq.", translation_fr: "Je cherche refuge dans les paroles parfaites d'Allah contre le mal de ce qu'Il a créé.", source: "Muslim" },
            { id: 6, category: "Savoir", arabic: "رَبِّ زِدْنِي عِلْمًا", transliteration: "Rabbi zidnī ʿilmā.", translation_fr: "Seigneur, accrois mes connaissances !", source: "Coran, 20:114" },
            { id: 7, category: "Soir", arabic: "أَمْسَيْنَا وَأَمْسَى الْمُلْكُ لِلَّهِ...", transliteration: "Amsaynā wa amsá l-mulku li-llāh...", translation_fr: "Nous voici au soir et la royauté appartient à Allah...", source: "Muslim" },
            { id: 8, category: "Voyage", arabic: "سُبْحَانَ الَّذِي سَخَّرَ لَنَا هَذَا وَمَا كُنَّا لَهُ مُقْرِنِينَ وَإِنَّا إِلَى رَبِّنَا لَمُنْقَلِبُونَ", transliteration: "Subḥāna-lladhī sakhkhara lanā hādhā wa mā kunnā lahū muqrinīn. Wa innā ilā rabbinā la-munqalibūn.", translation_fr: "Gloire à Celui qui a mis ceci à notre service alors que nous n'étions pas capables de le dominer. - Et c'est vers notre Seigneur que nous retournerons.", source: "Coran, 43:13-14" },
            { id: 9, category: "Maladie", arabic: "اللَّهُمَّ رَبَّ النَّاسِ، أَذْهِبِ الْبَأْسَ، اشْفِ أَنْتَ الشَّافِي، لاَ شِفَاءَ إِلاَّ شِفَاؤُكَ، شِفَاءً لاَ يُغَادِرُ سَقَمًا", transliteration: "Allāhumma rabba-n-nās, adhhibi-l-ba's, ishfi anta-sh-shāfī, lā shifā'a illā shifā'uk, shifā'an lā yughādiru saqamā.", translation_fr: "Ô Allah, Seigneur des hommes, fais partir le mal. Guéris, car Tu es le Guérisseur. Il n'y a de guérison que la Tienne, une guérison qui ne laisse aucune maladie.", source: "Bukhari, Muslim" },
            { id: 10, category: "Famille", arabic: "رَبَّنَا هَبْ لَنَا مِنْ أَزْوَاجِنَا وَذُرِّيَّاتِنَا قُرَّةَ أَعْيُنٍ وَاجْعَلْنَا لِلْمُتَّقِينَ إِمَامًا", transliteration: "Rabbanā hab lanā min azwājinā wa dhurriyyātinā qurrata aʿyunin wa-jʿalnā li-l-muttaqīna imāmā.", translation_fr: "Seigneur, donne-nous, en nos épouses et nos descendants, la joie des yeux, et fais de nous un guide pour les pieux.", source: "Coran, 25:74" },
            { id: 11, category: "Tristesse", arabic: "اللَّهُمَّ إِنِّي أَعُوذُ بِكَ مِنَ الْهَمِّ وَالْحَزَنِ، وَالْعَجْزِ وَالْكَسَلِ، وَالْبُخْلِ وَالْجُبْنِ، وَضَلَعِ الدَّيْنِ وَغَلَبَةِ الرِّجَالِ", transliteration: "Allāhumma innī aʿūdhu bika mina-l-hammi wa-l-ḥazan...", translation_fr: "Ô Allah, je me réfugie auprès de Toi contre les soucis et la tristesse, l'incapacité et la paresse...", source: "Bukhari" },
            { id: 12, category: "Facilité", arabic: "اللَّهُمَّ لاَ سَهْلَ إِلاَّ مَا جَعَلْتَهُ سَهْلاً، وَأَنْتَ تَجْعَلُ الْحَزْنَ إِذَا شِئْتَ سَهْلاً", transliteration: "Allāhumma lā sahla illā mā jaʿaltahū sahlā, wa anta tajʿalu-l-ḥazna idhā shi'ta sahlā.", translation_fr: "Ô Allah ! Rien n'est facile, sauf ce que Tu as rendu facile, et Tu es Celui qui, quand Tu veux, rend la tristesse facile.", source: "Ibn Hibban" }
        ];

        // --- Éléments du DOM ---
        const mainContent = document.getElementById('main-content');
        const categoriesList = document.getElementById('categories-list');
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const sidebar = document.getElementById('sidebar');
        const notification = document.getElementById('notification');
        const searchInput = document.getElementById('search-input');
        
        // Modale
        const favoritesModal = document.getElementById('favorites-modal');
        const closeModalBtn = document.getElementById('close-modal-btn');
        const favoritesListContainer = document.getElementById('favorites-list');

        let currentDua = null;
        let favorites = JSON.parse(localStorage.getItem('duaFavorites')) || [];

        // --- VUES ---
        const generatorViewHTML = `
            <div id="dua-display" class="bg-gray-900/50 backdrop-blur-sm border border-gray-700 rounded-2xl p-6 md:p-8 shadow-2xl min-h-[400px] flex flex-col justify-center items-center text-center transition-all">
                <div id="dua-content" class="w-full"></div>
            </div>
            <div class="mt-8 text-center">
                <button id="generate-dua-btn" class="bg-primary text-gray-900 font-bold py-4 px-8 rounded-full text-lg shadow-lg hover:bg-emerald-400 transition-all transform hover:scale-105">
                    <i class="fas fa-magic mr-2"></i> Générer une autre Doua
                </button>
            </div>`;

        // --- Fonctions ---
        function showNotification(message) {
            notification.textContent = message;
            notification.classList.remove('opacity-0', 'translate-y-[-20px]');
            setTimeout(() => {
                notification.classList.add('opacity-0', 'translate-y-[-20px]');
            }, 2000);
        }

        function displayDua(dua) {
            currentDua = dua;
            if(!document.getElementById('dua-display')) mainContent.innerHTML = generatorViewHTML;
            const duaContent = document.getElementById('dua-content');
            
            duaContent.innerHTML = `
                <div class="mb-6"><span class="bg-primary/20 text-primary text-sm font-bold px-3 py-1 rounded-full">${dua.category}</span></div>
                <p class="font-amiri text-3xl md:text-4xl lg:text-5xl leading-relaxed text-white text-center mb-4" dir="rtl">${dua.arabic}</p>
                <p class="text-lg text-gray-300 italic mb-6">${dua.transliteration}</p>
                <p class="text-lg text-gray-200 mb-8">"${dua.translation_fr}"</p>
                <div class="flex items-center justify-center space-x-2 md:space-x-4 mb-8">
                    <button class="action-btn" id="play-audio-btn" title="Écouter la récitation"><i class="fas fa-volume-up"></i></button>
                    <button class="action-btn ${favorites.includes(dua.id) ? 'active' : ''}" id="favorite-toggle-btn" title="Ajouter aux favoris"><i class="fas fa-heart"></i></button>
                    <button class="action-btn" id="copy-dua-btn" title="Copier le texte"><i class="fas fa-copy"></i></button>
                    <button class="action-btn" id="share-dua-btn" title="Partager"><i class="fas fa-share-alt"></i></button>
                </div>
                <div class="border-t border-gray-700 pt-4"><p class="text-sm text-gray-500 font-semibold">Source : <span class="font-medium text-gray-400">${dua.source}</span></p></div>
            `;
            
            document.getElementById('generate-dua-btn').addEventListener('click', () => generateDua());
            document.getElementById('favorite-toggle-btn').addEventListener('click', toggleFavorite);
            document.getElementById('copy-dua-btn').addEventListener('click', copyDua);
            document.getElementById('share-dua-btn').addEventListener('click', shareDua);
            document.getElementById('play-audio-btn').addEventListener('click', () => playAudio(dua.arabic));
        }

        function renderDuaList(duaList, title) {
            mainContent.innerHTML = `
                <h2 class="text-3xl font-bold text-white mb-6">${title}</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${duaList.map(dua => `
                        <div class="bg-gray-800/50 p-4 rounded-lg cursor-pointer hover:bg-gray-700/50 transition-all" onclick="navigateToDua(${dua.id})">
                            <p class="font-semibold text-white truncate">${dua.translation_fr}</p>
                            <p class="text-sm text-gray-400">${dua.category}</p>
                        </div>
                    `).join('') || `<p class="text-gray-400">Aucun résultat trouvé.</p>`}
                </div>`;
        }
        window.navigateToDua = (id) => {
            const dua = duas.find(d => d.id === id);
            if (dua) displayDua(dua);
        };

        function generateDua(category = null) {
            let filteredDuas = duas;
            if (category) filteredDuas = duas.filter(d => d.category === category);
            const randomIndex = Math.floor(Math.random() * filteredDuas.length);
            displayDua(filteredDuas[randomIndex]);
        }
        
        function loadCategories() {
            const categories = [...new Set(duas.map(d => d.category))];
            categoriesList.innerHTML = categories.map(cat => `
                <li><a href="#" data-category="${cat}" class="flex items-center text-lg font-medium text-gray-400 hover:text-primary transition-all"><i class="fas fa-tag w-8 text-center"></i> ${cat}</a></li>
            `).join('');
            categoriesList.querySelectorAll('a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    generateDua(e.currentTarget.dataset.category);
                    if (window.innerWidth < 768) sidebar.classList.add('-translate-x-full');
                });
            });
        }
        
        function toggleFavorite() {
            if (!currentDua) return;
            const btn = document.getElementById('favorite-toggle-btn');
            const index = favorites.indexOf(currentDua.id);
            if (index > -1) {
                favorites.splice(index, 1);
                btn.classList.remove('active');
                showNotification("Retiré des favoris");
            } else {
                favorites.push(currentDua.id);
                btn.classList.add('active');
                showNotification("Ajouté aux favoris !");
            }
            localStorage.setItem('duaFavorites', JSON.stringify(favorites));
        }
        
        function showFavorites() {
            const favoriteDuas = duas.filter(d => favorites.includes(d.id));
            favoritesListContainer.innerHTML = favoriteDuas.map(dua => `
                <div class="p-3 border-b border-gray-700 cursor-pointer hover:bg-gray-800 rounded" onclick="navigateToDua(${dua.id}); closeModal();">
                    <p class="font-semibold text-white">${dua.translation_fr}</p>
                </div>
            `).join('') || `<p class="text-gray-400 p-3">Vous n'avez pas encore de favoris.</p>`;
            favoritesModal.classList.remove('opacity-0', 'pointer-events-none');
            favoritesModal.querySelector('.modal-content').classList.remove('scale-95');
        }
        window.closeModal = () => {
            favoritesModal.classList.add('opacity-0', 'pointer-events-none');
            favoritesModal.querySelector('.modal-content').classList.add('scale-95');
        };

        function copyDua() {
            if (!currentDua) return;
            const textToCopy = `${currentDua.arabic}\n\n${currentDua.translation_fr}\n(Source: ${currentDua.source})`;
            navigator.clipboard.writeText(textToCopy).then(() => showNotification("Doua copiée !"));
        }
        
        function shareDua() {
            if (!currentDua) return;
            const shareData = {
                title: 'Perles d\'Invocations',
                text: `${currentDua.arabic}\n\n"${currentDua.translation_fr}"\n(Source: ${currentDua.source})`,
                url: window.location.href,
            };
            if (navigator.share) {
                navigator.share(shareData).catch(err => console.log('Erreur de partage:', err));
            } else {
                copyDua();
                showNotification("Doua copiée. Vous pouvez la partager.");
            }
        }
        
        function playAudio(text) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ar-SA'; // Spécifier la langue pour une meilleure prononciation
                utterance.rate = 0.8;
                window.speechSynthesis.speak(utterance);
            } else {
                showNotification("La synthèse vocale n'est pas supportée par votre navigateur.");
            }
        }

        function getDuaOfTheDay() {
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            displayDua(duas[dayOfYear % duas.length]);
        }
        
        function handleSearch(query) {
            if (query.trim() === '') {
                getDuaOfTheDay();
                return;
            }
            const lowerQuery = query.toLowerCase();
            const results = duas.filter(d => 
                d.translation_fr.toLowerCase().includes(lowerQuery) ||
                d.transliteration.toLowerCase().includes(lowerQuery) ||
                d.category.toLowerCase().includes(lowerQuery)
            );
            renderDuaList(results, `Résultats pour "${query}"`);
        }

        // --- Initialisation et Écouteurs d'événements ---
        document.getElementById('home-btn').addEventListener('click', (e) => { e.preventDefault(); generateDua(); });
        document.getElementById('dua-of-the-day-btn').addEventListener('click', (e) => { e.preventDefault(); getDuaOfTheDay(); });
        document.getElementById('favorites-btn').addEventListener('click', (e) => { e.preventDefault(); showFavorites(); });
        mobileMenuBtn.addEventListener('click', () => sidebar.classList.toggle('-translate-x-full'));
        closeModalBtn.addEventListener('click', closeModal);
        favoritesModal.addEventListener('click', (e) => { if (e.target === favoritesModal) closeModal(); });
        searchInput.addEventListener('input', (e) => handleSearch(e.target.value));

        loadCategories();
        getDuaOfTheDay(); // Affiche la Doua du jour au chargement
    });
    </script>
</body>
</html>

