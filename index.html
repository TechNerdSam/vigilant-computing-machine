<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analyse des Lataifs par Questionnaire v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Lato:wght@300;400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Lato', sans-serif; }
        h1, h2, h3, h4 { font-family: 'Playfair Display', serif; }
        .glowing-button { transition: all 0.3s ease; }
        .glowing-button:hover {
            box-shadow: 0 0 20px 5px rgba(79, 70, 229, 0.6);
            transform: translateY(-2px);
        }
        .result-card {
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        #questionnaire-modal, #results-content { transition: opacity 0.5s ease-in-out; }
        .question-card {
            border-left: 4px solid #4f46e5;
        }
        input[type="radio"]:checked + label {
            background-color: #4f46e5;
            border-color: #6366f1;
            color: white;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-900 via-indigo-900 to-black text-gray-200 min-h-screen flex flex-col items-center justify-center p-4">

    <!-- Écran du Questionnaire -->
    <div id="questionnaire-modal" class="w-full max-w-4xl mx-auto bg-black bg-opacity-30 rounded-2xl shadow-2xl p-6 md:p-8 border border-gray-700">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-amber-300 mb-2">Questionnaire de Réflexion</h1>
            <p class="text-lg text-gray-300 max-w-3xl mx-auto">
                Prenez un moment pour répondre honnêtement. Vos réponses détermineront l'analyse de vos centres spirituels.
            </p>
        </div>
        <form id="lataif-questionnaire" class="space-y-8 max-h-[60vh] overflow-y-auto pr-4">
            <!-- Les questions seront injectées ici par JavaScript -->
        </form>
        <div class="mt-8 text-center">
            <button id="submit-questionnaire-btn" class="glowing-button bg-indigo-600 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg hover:bg-indigo-500">
                Voir les Résultats
            </button>
        </div>
    </div>

    <!-- Écran des Résultats -->
    <div id="results-content" class="w-full max-w-7xl mx-auto bg-black bg-opacity-30 rounded-2xl shadow-2xl p-6 md:p-8 border border-gray-700 opacity-0 hidden">
        <div class="text-center mb-8">
            <h1 class="text-4xl md:text-5xl font-bold text-amber-300 mb-2">Votre Réflexion Personnelle</h1>
            <p class="text-lg text-gray-300 max-w-4xl mx-auto">
                Voici une interprétation de votre état intérieur basée sur vos propres réponses.
            </p>
        </div>
        <div id="results-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
             <!-- Les résultats seront injectés ici -->
        </div>
        <div class="mt-8 text-center">
             <button id="reset-btn" class="glowing-button bg-red-600 text-white font-bold py-2 px-6 rounded-lg shadow-lg hover:bg-red-500">
                Recommencer
            </button>
        </div>
    </div>

    <footer class="text-center text-gray-500 mt-6 text-sm">
        <p>&copy; 2025 Miroir des Lataif Soufis. Tous droits réservés.</p>
        <p class="mt-1 max-w-3xl mx-auto">Avertissement : Cet outil est un support pour l'introspection. Il ne fournit pas de diagnostic et ne remplace pas un avis qualifié.</p>
    </footer>

    <script>
        const questionnaireModal = document.getElementById('questionnaire-modal');
        const resultsContent = document.getElementById('results-content');
        const questionnaireForm = document.getElementById('lataif-questionnaire');
        const submitBtn = document.getElementById('submit-questionnaire-btn');
        const resultsGrid = document.getElementById('results-grid');
        const resetBtn = document.getElementById('reset-btn');

        const questions = [
            // Qalb
            { latifa: 'qalb', text: "En ce moment, je ressens de la chaleur et de la compassion envers les autres :", options: [{ text: "Souvent", value: 0 }, { text: "Parfois", value: 1 }, { text: "Rarement", value: 2 }] },
            { latifa: 'qalb', text: "Mon cœur se sent-il léger et en paix ou lourd et préoccupé ?", options: [{ text: "Léger et en paix", value: 0 }, { text: "Un peu lourd", value: 1 }, { text: "Très lourd", value: 2 }] },
            // Ruh
            { latifa: 'ruh', text: "Mes pensées sont-elles claires et fluides ou confuses et chaotiques ?", options: [{ text: "Claires et fluides", value: 0 }, { text: "Un peu confuses", value: 1 }, { text: "Très chaotiques", value: 2 }] },
            { latifa: 'ruh', text: "Je me sens inspiré(e) et créatif(ve) en ce moment :", options: [{ text: "Oui, beaucoup", value: 0 }, { text: "Un peu", value: 1 }, { text: "Pas du tout", value: 2 }] },
            { latifa: 'ruh', text: "Mon niveau d'énergie spirituelle est :", options: [{ text: "Élevé", value: 0 }, { text: "Moyen", value: 1 }, { text: "Faible", value: 2 }] },
            // Sirr
            { latifa: 'sirr', text: "Je suis attentif(ve) aux signes subtils et à mon intuition :", options: [{ text: "Très attentif(ve)", value: 0 }, { text: "Parfois", value: 1 }, { text: "Rarement", value: 2 }] },
            { latifa: 'sirr', text: "J'ai récemment pris le temps pour une contemplation silencieuse :", options: [{ text: "Oui, régulièrement", value: 0 }, { text: "Une ou deux fois", value: 1 }, { text: "Non", value: 2 }] },
            { latifa: 'sirr', text: "Je sens que je perçois les choses au-delà des apparences :", options: [{ text: "Souvent", value: 0 }, { text: "De temps en temps", value: 1 }, { text: "Jamais", value: 2 }] },
            // Khafi
            { latifa: 'khafi', text: "Je ressens une paix profonde, même au milieu de l'agitation :", options: [{ text: "Oui, souvent", value: 0 }, { text: "Parfois", value: 1 }, { text: "Rarement", value: 2 }] },
            { latifa: 'khafi', text: "Je fais face à l'inconnu avec confiance (Tawakkul) :", options: [{ text: "Presque toujours", value: 0 }, { text: "J'essaie, mais c'est difficile", value: 1 }, { text: "Je suis souvent anxieux(se)", value: 2 }] },
            // Akhfa
            { latifa: 'akhfa', text: "Je ressens un sentiment de connexion avec tout ce qui m'entoure :", options: [{ text: "Fréquemment", value: 0 }, { text: "Occasionnellement", value: 1 }, { text: "Très rarement", value: 2 }] },
            { latifa: 'akhfa', text: "Je suis capable de me détacher de mon identité et de simplement 'être' :", options: [{ text: "Oui, dans les moments calmes", value: 0 }, { text: "C'est un objectif difficile", value: 1 }, { text: "Je ne suis pas sûr(e)", value: 2 }] },
            // Nafs
            { latifa: 'nafs', text: "Mes désirs et impulsions contrôlent-ils mes actions ?", options: [{ text: "Rarement", value: 0 }, { text: "Parfois, c'est une lutte", value: 1 }, { text: "Souvent", value: 2 }] },
            { latifa: 'nafs', text: "Je ressens de l'orgueil ou le besoin d'avoir raison :", options: [{ text: "Rarement", value: 0 }, { text: "De temps en temps", value: 1 }, { text: "Assez souvent", value: 2 }] },
            { latifa: 'nafs', text: "Je suis capable d'accepter la critique avec humilité :", options: [{ text: "Oui, la plupart du temps", value: 0 }, { text: "C'est difficile", value: 1 }, { text: "Non, je me sens attaqué(e)", value: 2 }] },
        ];

        const lataifData = {
            qalb: { name: "Qalb (Le Cœur)", color: { class: "amber-400" }, threshold: 1, states: [ { title: "Serein et Ouvert", interpretation: "Votre cœur est en paix, réceptif à la compassion. Un moment propice pour la connexion sincère." }, { title: "Agité et Fermé", interpretation: "Le Qalb est troublé par les préoccupations, créant un sentiment de déconnexion." } ] },
            ruh: { name: "Ruh (L'Esprit)", color: { class: "red-500" }, threshold: 2, states: [ { title: "Élevé et Inspiré", interpretation: "Votre esprit est connecté à des inspirations supérieures. Votre intuition spirituelle est aiguisée." }, { title: "Lourd et Fatigué", interpretation: "L'esprit se sent accablé. L'inspiration est difficile à trouver." } ] },
            sirr: { name: "Sirr (Le Secret)", color: { class: "white" }, threshold: 2, states: [ { title: "Lumineux et Conscient", interpretation: "Votre vision intérieure semble nette, percevant au-delà des apparences." }, { title: "Voilé et Obscurci", interpretation: "Votre vision intérieure est obscurcie par le bavardage mental." } ] },
            khafi: { name: "Khafi (Le Caché)", color: { class: "white" }, threshold: 1, states: [ { title: "Paisible et Stable", interpretation: "Vous ressentez une quiétude profonde, au-delà des pensées et des émotions." }, { title: "Perturbé et Instable", interpretation: "Des émotions profondes pourraient perturber votre tranquillité." } ] },
            akhfa: { name: "Akhfa (Le Plus Caché)", color: { class: "emerald-500" }, threshold: 1, states: [ { title: "En Unité (Fana)", interpretation: "Vous ressentez un aperçu de l'Unité, un état de pure conscience." }, { title: "Endormi et Inconscient", interpretation: "Le potentiel de ce centre n'est pas encore pleinement éveillé." } ] },
            nafs: { name: "Nafs (L'Ego / Le Soi)", color: { class: "slate-500" }, threshold: 2, states: [ { title: "Pacifié (Mutma'inna)", interpretation: "Votre ego est en paix et aligné avec la volonté divine." }, { title: "Impérieux (Ammara)", interpretation: "L'ego dicte des désirs impulsifs. Une lutte intérieure est présente." } ] }
        };

        function populateQuestionnaire() {
            let html = '';
            questions.forEach((q, index) => {
                html += `
                <div class="bg-gray-800/50 p-4 rounded-lg question-card">
                    <p class="mb-3 font-semibold text-gray-300">${index + 1}. ${q.text}</p>
                    <div class="flex flex-col sm:flex-row gap-2">`;
                q.options.forEach((opt, optIndex) => {
                    html += `
                        <div class="flex-1">
                            <input type="radio" id="q${index}_${optIndex}" name="q${index}" value="${opt.value}" class="hidden" required>
                            <label for="q${index}_${optIndex}" class="block w-full text-center p-2 rounded-md border border-gray-600 hover:bg-indigo-500/50 transition-colors duration-200 cursor-pointer text-sm">
                                ${opt.text}
                            </label>
                        </div>`;
                });
                html += `</div></div>`;
            });
            questionnaireForm.innerHTML = html;
        }

        function calculateResults() {
            const formData = new FormData(questionnaireForm);
            const scores = { qalb: 0, ruh: 0, sirr: 0, khafi: 0, akhfa: 0, nafs: 0 };
            
            for (let i = 0; i < questions.length; i++) {
                const latifa = questions[i].latifa;
                const value = parseInt(formData.get(`q${i}`));
                if (!isNaN(value)) {
                    scores[latifa] += value;
                }
            }

            const finalStates = {};
            for (const key in scores) {
                finalStates[key] = scores[key] > lataifData[key].threshold ? 1 : 0;
            }
            return finalStates;
        }

        function displayResults(states) {
            resultsGrid.innerHTML = '';
            for (const key in states) {
                const data = lataifData[key];
                const state = data.states[states[key]];
                const cardHTML = `
                    <div class="result-card bg-gray-800 bg-opacity-60 border-2 border-slate-600 rounded-xl p-4 shadow-lg h-full flex flex-col">
                        <div class="flex items-center mb-2">
                            <div class="w-3 h-3 rounded-full bg-${data.color.class} mr-2"></div>
                            <h3 class="text-lg font-bold text-${data.color.class}">${data.name}</h3>
                        </div>
                        <div>
                           <h4 class="text-md font-semibold text-white mb-1">${state.title}</h4>
                           <p class="text-sm text-gray-300">${state.interpretation}</p>
                        </div>
                    </div>`;
                resultsGrid.innerHTML += cardHTML;
            }
        }
        
        submitBtn.addEventListener('click', (e) => {
            e.preventDefault();
            if (questionnaireForm.checkValidity()) {
                const finalStates = calculateResults();
                displayResults(finalStates);

                questionnaireModal.classList.add('opacity-0');
                setTimeout(() => {
                    questionnaireModal.classList.add('hidden');
                    resultsContent.classList.remove('hidden');
                    setTimeout(() => resultsContent.classList.remove('opacity-0'), 50);
                }, 500);
            } else {
                alert("Veuillez répondre à toutes les questions.");
            }
        });

        resetBtn.addEventListener('click', () => {
             resultsContent.classList.add('opacity-0');
            setTimeout(() => {
                resultsContent.classList.add('hidden');
                questionnaireModal.classList.remove('hidden');
                questionnaireForm.reset();
                setTimeout(() => questionnaireModal.classList.remove('opacity-0'), 50);
            }, 500);
        });

        // Initialisation
        populateQuestionnaire();
    </script>
</body>
</html>

